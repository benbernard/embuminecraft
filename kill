os.loadAPI("/mov")

mt = mov.MoveTracker.new()

-- Slot list --
-- 1: Cobblestone
-- 2: Fuel

kill_forward = function()
    print( "Killing forward")
    while 1 do
        mt:max_forward()
        if turtle.detect() then
            break
        else
            while turtle.attack() do
            end
        end
    end
end

kill_one_forward = function()
    while 1 do
        while turtle.attack() do
        end
        if mt:f() then
            return
        end
    end
end
    


count = 0
while 1 do
    while 1 do
        count = count +1
        print("Killing row " .. count)

        kill_forward()
        mt:turn_to(1)

        if turtle.detect() then
            mt:return_to_base()
            break
        end

        kill_one_forward()
        mt:turn_to(2)
        kill_forward()
        mt:turn_to(1)
        if turtle.detect() then
            mt:return_to_base()
            break
        end
        kill_one_forward()
        mt:turn_to(0)
    end

    mt:turn_to(2)
    for slot = 1, 16, 1 do
        turtle.select(slot)
        turtle.drop()
    end

    mt:turn_to(0)

    while turtle.getFuelLevel() < 1255 do
        print("Waiting for fuel up to 1255, Currently at " .. turtle.getFuelLevel())
        sleep(1)
    end
end


