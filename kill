--  vim: set ft=lua:

local mov = { face = 0 }

mov.left = function ()
    print("Turning left")
    mov.face = (mov.face - 1) % 4
    return turtle.left()
end

mov.right = function ()
    print("Turning right")
    mov.face = (mov.face + 1) % 4
    return turtle.right()
end

mov.f = function()
    print("Move forward")
    return turtle.forward()
end

mov.b = function()
    print("Move backward")
    return turtle.backward()
end

mov.max_forward = function()
    print("Max forward")
    while mov.f() do
    end
end

mov.max_backward = function()
    print("Max backward")
    while mov.b() do
    end
end

mov.has_facing = function(facing)
    return facing == mov.face
end

mov.turn_to = function(facing)
    print("Turning to " .. facing)
    if facing - mov.face >= 2 then
        while mov.has_facing(facing) do
            mov.right()
        end
    else
        while mov.has_facing(facing) do
            mov.left()
        end
    end
end

mov.return_to_base = function()
    print("Returning to base")
    mov.turn_to(2)
    mov.max_forward()
    if is_cobble() then
        mov.turn_to(3)
        mov.max_forward()
        
        if is_cobble() then
            mov.turn_to(0)
        end
    end
end

-- Slot list --
-- 1: Cobblestone
-- 2: Fuel

is_cobble = function()
    turtle.select(1)
    return turtle.compare()
end

mov.return_to_base()
